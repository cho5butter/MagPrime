<Window
    x:Class="MagPrime.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:Microsoft.UI.Xaml.Controls"
    xmlns:toolkit="using:CommunityToolkit.WinUI.Controls"
    xmlns:vm="using:MagPrime.ViewModels"
    mc:Ignorable="d">

    <Grid Background="{ThemeResource SurfaceBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <StackPanel Orientation="Horizontal" VerticalAlignment="Top" Padding="32" Spacing="12">
            <FontIcon Glyph="&#xE73E;" FontSize="32" Foreground="White" />
            <StackPanel>
                <TextBlock Text="MagPrime Control Center"
                           FontSize="24"
                           FontWeight="SemiBold"
                           Foreground="White" />
                <TextBlock Text="右クリックウィンドウサーフェスのステータスとウィンドウ一覧"
                           Foreground="#C0C8D4"
                           FontSize="14" />
            </StackPanel>
        </StackPanel>

        <Grid Grid.Row="1" Padding="32">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <StackPanel Spacing="16">
                <toolkit:SettingsCard Header="常駐サービス" Description="グローバル右クリックフックとウィンドウ移動を制御します。">
                    <toolkit:SettingsCard.ActionContent>
                        <ToggleSwitch x:Name="ServiceToggle"
                                      IsOn="{x:Bind ViewModel.ServiceActive, Mode=OneWay}"
                                      Foreground="White"
                                      Toggled="ServiceToggle_Toggled" />
                    </toolkit:SettingsCard.ActionContent>
                </toolkit:SettingsCard>

                <controls:InfoBar Severity="Informational"
                                   Title="サービス状態"
                                   IsOpen="True"
                                   Message="{x:Bind ViewModel.StatusMessage, Mode=OneWay}" />

                <Grid ColumnSpacing="12" RowSpacing="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="監視中のウィンドウ"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="White" />
                        <controls:InfoBadge Value="{x:Bind ViewModel.WindowCount, Mode=OneWay}" />
                    </StackPanel>
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                        <Button x:Name="RefreshButton"
                                Content="最新の状態を取得"
                                Style="{StaticResource AccentButtonStyle}"
                                Click="RefreshButton_Click" />
                    </StackPanel>
                </Grid>
            </StackPanel>

            <Border Grid.Row="1"
                    Margin="0,16,0,0"
                    Padding="{StaticResource CardPadding}"
                    CornerRadius="24"
                    Background="{ThemeResource CardBrush}">
                <ListView ItemsSource="{x:Bind ViewModel.Windows, Mode=OneWay}" SelectionMode="None">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="vm:WindowListItem">
                            <Border CornerRadius="18"
                                    Padding="16"
                                    Margin="0,6"
                                    Background="#262F3F">
                                <Grid ColumnSpacing="16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="12">
                                        <FontIcon Glyph="{x:Bind Glyph}" FontSize="20" Foreground="#7DD3FC" />
                                        <StackPanel>
                                            <TextBlock Text="{x:Bind Title}"
                                                       FontWeight="SemiBold"
                                                       Foreground="White"
                                                       TextTrimming="CharacterEllipsis" />
                                            <TextBlock Text="{x:Bind Subtitle}"
                                                       Foreground="#9CA3AF"
                                                       FontSize="13" />
                                        </StackPanel>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center" Orientation="Horizontal" Spacing="8">
                                        <Border Background="#344055"
                                                Padding="8,4"
                                                CornerRadius="12">
                                            <TextBlock Text="{x:Bind Status}"
                                                       Foreground="#60A5FA"
                                                       FontSize="12" />
                                        </Border>
                                        <TextBlock Text="{x:Bind Dimensions}"
                                                   Foreground="#9CA3AF"
                                                   FontSize="13" />
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Border>

            <Grid Grid.Row="1" Panel.ZIndex="1" IsHitTestVisible="False">
                <Grid.Background>
                    <SolidColorBrush Color="Transparent" />
                </Grid.Background>
                <ProgressRing IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"
                              Width="48"
                              Height="48" />
            </Grid>
        </Grid>
    </Grid>
</Window>
