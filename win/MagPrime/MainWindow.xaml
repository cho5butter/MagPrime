<Window
    x:Class="MagPrime.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:Microsoft.UI.Xaml.Controls"
    xmlns:toolkit="using:CommunityToolkit.WinUI.Controls"
    xmlns:vm="using:MagPrime.ViewModels"
    xmlns:media="using:Microsoft.UI.Xaml.Media"
    mc:Ignorable="d">

    <Grid>
        <!-- Modern Mica Background -->
        <Grid.BackgroundTransition>
            <BrushTransition Duration="{StaticResource NormalDuration}" />
        </Grid.BackgroundTransition>
        <Grid.Background>
            <SolidColorBrush Color="Transparent" />
        </Grid.Background>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Modern Header with Glow Effect -->
        <Grid Padding="40,32,40,24">
            <Grid.OpacityTransition>
                <ScalarTransition Duration="{StaticResource NormalDuration}" />
            </Grid.OpacityTransition>

            <StackPanel Orientation="Horizontal" Spacing="16">
                <!-- Icon with Glow Effect -->
                <Border Width="56" Height="56"
                        CornerRadius="16"
                        Background="{ThemeResource AccentFillColorDefaultBrush}">
                    <Border.Shadow>
                        <ThemeShadow />
                    </Border.Shadow>
                    <Border.Translation>0,0,8</Border.Translation>
                    <FontIcon Glyph="&#xE73E;"
                              FontSize="28"
                              Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center" />
                </Border>

                <!-- Title Section -->
                <StackPanel VerticalAlignment="Center" Spacing="4">
                    <TextBlock Text="MagPrime Control Center"
                               Style="{StaticResource TitleTextBlockStyle}"
                               FontWeight="SemiBold" />
                    <TextBlock Text="右クリックウィンドウサーフェスのステータスとウィンドウ一覧"
                               Style="{StaticResource BodyTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Opacity="0.8" />
                </StackPanel>
            </StackPanel>
        </Grid>

        <!-- Main Content Area -->
        <Grid Grid.Row="1" Padding="40,0,40,32">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Control Section with Modern Cards -->
            <StackPanel Spacing="12">
                <!-- Service Control Card -->
                <toolkit:SettingsCard Header="常駐サービス"
                                      Description="グローバル右クリックフックとウィンドウ移動を制御します。"
                                      CornerRadius="{StaticResource ControlCornerRadius}">
                    <toolkit:SettingsCard.OpacityTransition>
                        <ScalarTransition Duration="{StaticResource NormalDuration}" />
                    </toolkit:SettingsCard.OpacityTransition>
                    <toolkit:SettingsCard.ActionContent>
                        <ToggleSwitch x:Name="ServiceToggle"
                                      IsOn="{x:Bind ViewModel.ServiceActive, Mode=OneWay}"
                                      Toggled="ServiceToggle_Toggled">
                            <ToggleSwitch.OpacityTransition>
                                <ScalarTransition Duration="{StaticResource FastDuration}" />
                            </ToggleSwitch.OpacityTransition>
                        </ToggleSwitch>
                    </toolkit:SettingsCard.ActionContent>
                </toolkit:SettingsCard>

                <!-- Status Info Bar -->
                <controls:InfoBar Severity="Informational"
                                   Title="サービス状態"
                                   IsOpen="True"
                                   CornerRadius="{StaticResource ControlCornerRadius}"
                                   Message="{x:Bind ViewModel.StatusMessage, Mode=OneWay}">
                    <controls:InfoBar.OpacityTransition>
                        <ScalarTransition Duration="{StaticResource NormalDuration}" />
                    </controls:InfoBar.OpacityTransition>
                </controls:InfoBar>

                <!-- Window List Header -->
                <Grid ColumnSpacing="16" Margin="0,12,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                        <TextBlock Text="監視中のウィンドウ"
                                   Style="{StaticResource SubtitleTextBlockStyle}"
                                   FontWeight="SemiBold" />
                        <controls:InfoBadge Value="{x:Bind ViewModel.WindowCount, Mode=OneWay}"
                                            Style="{StaticResource AttentionValueInfoBadgeStyle}">
                            <controls:InfoBadge.OpacityTransition>
                                <ScalarTransition Duration="{StaticResource FastDuration}" />
                            </controls:InfoBadge.OpacityTransition>
                        </controls:InfoBadge>
                    </StackPanel>

                    <Button x:Name="RefreshButton"
                            Grid.Column="1"
                            Content="最新の状態を取得"
                            Style="{StaticResource AccentButtonStyle}"
                            CornerRadius="{StaticResource ControlCornerRadius}"
                            Click="RefreshButton_Click">
                        <Button.OpacityTransition>
                            <ScalarTransition Duration="{StaticResource FastDuration}" />
                        </Button.OpacityTransition>
                    </Button>
                </Grid>
            </StackPanel>

            <!-- Modern Window List Card with Shadow -->
            <Border Grid.Row="1"
                    Margin="0,16,0,0"
                    Padding="{StaticResource CardPadding}"
                    CornerRadius="{StaticResource CardCornerRadius}"
                    Background="{ThemeResource CardBrush}">
                <Border.Shadow>
                    <ThemeShadow />
                </Border.Shadow>
                <Border.Translation>0,0,16</Border.Translation>
                <Border.OpacityTransition>
                    <ScalarTransition Duration="{StaticResource NormalDuration}" />
                </Border.OpacityTransition>

                <ListView ItemsSource="{x:Bind ViewModel.Windows, Mode=OneWay}"
                          SelectionMode="None">
                    <ListView.ItemsPanel>
                        <ItemsPanelTemplate>
                            <ItemsStackPanel />
                        </ItemsPanelTemplate>
                    </ListView.ItemsPanel>

                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="vm:WindowListItem">
                            <Border CornerRadius="{StaticResource ControlCornerRadius}"
                                    Padding="20,16"
                                    Margin="0,4"
                                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                                    PointerEntered="WindowItem_PointerEntered"
                                    PointerExited="WindowItem_PointerExited">
                                <Border.BackgroundTransition>
                                    <BrushTransition Duration="{StaticResource FastDuration}" />
                                </Border.BackgroundTransition>
                                <Border.OpacityTransition>
                                    <ScalarTransition Duration="{StaticResource FastDuration}" />
                                </Border.OpacityTransition>

                                <Grid ColumnSpacing="16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <!-- Icon and Title Section -->
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="16">
                                        <!-- Icon Background -->
                                        <Border Width="40" Height="40"
                                                CornerRadius="8"
                                                Background="{ThemeResource AccentFillColorSecondaryBrush}">
                                            <FontIcon Glyph="{x:Bind Glyph}"
                                                      FontSize="18"
                                                      Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center" />
                                        </Border>

                                        <!-- Text Content -->
                                        <StackPanel VerticalAlignment="Center" Spacing="2">
                                            <TextBlock Text="{x:Bind Title}"
                                                       FontWeight="SemiBold"
                                                       Style="{StaticResource BodyStrongTextBlockStyle}"
                                                       TextTrimming="CharacterEllipsis"
                                                       MaxWidth="300" />
                                            <TextBlock Text="{x:Bind Subtitle}"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Status and Dimensions Section -->
                                    <StackPanel Grid.Column="2"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                Orientation="Horizontal"
                                                Spacing="12">
                                        <!-- Status Badge -->
                                        <Border Background="{ThemeResource AccentFillColorTertiaryBrush}"
                                                Padding="12,6"
                                                CornerRadius="6">
                                            <TextBlock Text="{x:Bind Status}"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       FontWeight="SemiBold"
                                                       Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}" />
                                        </Border>

                                        <!-- Dimensions -->
                                        <TextBlock Text="{x:Bind Dimensions}"
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                                   VerticalAlignment="Center" />
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Border>

            <Grid Grid.Row="1" Panel.ZIndex="1" IsHitTestVisible="False">
                <Grid.Background>
                    <SolidColorBrush Color="Transparent" />
                </Grid.Background>
                <ProgressRing IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"
                              Width="48"
                              Height="48" />
            </Grid>
        </Grid>
    </Grid>
</Window>
